{
  "name": "onvif",
  "version": "0.5.3",
  "author": {
    "name": "Andrew D.Laptev",
    "email": "a.d.laptev@gmail.com"
  },
  "description": "Client to ONVIF NVT devices Profile S: cameras",
  "main": "lib/onvif.js",
  "scripts": {
    "jsdoc": "jsdoc ./lib/*.js --readme ./README.md --destination ./docs",
    "gh-pages": "jsdoc ./lib/*.js --readme ./README.md --destination ./",
    "jscs": "jscs lib/*.js",
    "lint": "jshint lib/*.js",
    "coffee-tests": "coffee -c test/*.coffee",
    "pretest": "npm run lint && npm run jscs && npm run coffee-tests",
    "test": "istanbul cover _mocha",
    "test-on-travis": "npm run pretest && istanbul cover _mocha --report lcovonly",
    "test-coveralls": "istanbul cover _mocha --report lcovonly -- -R spec && cat ./coverage/lcov.info | coveralls && rm -rf ./coverage",
    "upload-to-coveralls": "cat ./coverage/lcov.info | coveralls"
  },
  "repository": {
    "type": "git",
    "url": "https://github.com/agsh/onvif.git"
  },
  "dependencies": {
    "xml2js": "^0.4"
  },
  "keywords": [
    "onvif",
    "video",
    "PTZ",
    "camera",
    "RTSP"
  ],
  "license": "MIT",
  "engines": {
    "node": ">=0.12"
  },
  "devDependencies": {
    "coffee-script": "^1.9.3",
    "coveralls": ">=2.11.2",
    "dot": "^1.0.3",
    "istanbul": ">=0.3.5",
    "jscs": "^1.13.1",
    "jsdoc": "^3.3.0",
    "jshint": "^2.7.0",
    "mocha": ">=2.1.0",
    "mocha-lcov-reporter": "0.0.1",
    "nimble": "^0.0.2",
    "keypress": "^0.2.1"
  },
  "readme": "# ONVIF\n\n[![Build Status](https://travis-ci.org/agsh/onvif.png)](https://travis-ci.org/agsh/onvif)\n[![Coverage Status](https://img.shields.io/coveralls/agsh/onvif.svg)](https://coveralls.io/r/agsh/onvif?branch=master)\n[![NPM version](https://img.shields.io/npm/v/onvif.svg)](https://www.npmjs.com/package/onvif)\n\nONVIF Client protocol Profile S (Live Streaming) and Profile G (Replay) Node.js implementation.\n\nThis is a wrapper to ONVIF protocol which allows you to get information about your NVT (network video transmitter)\ndevice, its media sources, control PTZ (pan-tilt-zoom) movements and manage presets, detect devices in your network and control its events.\nIt will also allow you to get information about your NVR (network video recorder) Profile G device and obtain a list of recordings.\n\n[![ONVIF](http://www.onvif.org/Portals/_default/Skins/onvif/images/logo-new.jpg)](http://onvif.org)\n\n## Installation\n\n### NPM\n\n`npm install onvif` - install latest stable version\n\n`npm install agsh/onvif` - install latest version from GitHub\n\n`npm install agsh/onvif#dev` - install latest development version\n\n### Clone the latest version from github\n`git clone https://github.com/agsh/onvif.git`\n\n### Tests\nIn the library directory run `npm test`\n\nBy default the tests use a mockup server to generate ONVIF replies.\n\nTo test with the real device, set appropriate environment variables `HOSTNAME`, `USERNAME`, `PASSWORD`, `PORT` and run \ntests.\n\n### Documentation\nTo build jsdoc for the library with default theme run `npm run jsdoc`. Otherwise use `jsdoc` with sources from\n`./lib/*.js`\n\n## Quick example\nThis example asks your camera to look up and starts a web server at port 3030 that distributes a web page with vlc-plugin\ncontainer which translates video from the camera.\n```javascript\nvar\n  http = require('http'),\n  Cam = require('onvif').Cam;\n\nnew Cam({\n  hostname: <CAMERA_HOST>,\n  username: <USERNAME>,\n  password: <PASSWORD>\n}, function(err) {\n  this.absoluteMove({x: 1, y: 1, zoom: 1});\n  this.getStreamUri({protocol:'RTSP'}, function(err, stream) {\n    http.createServer(function (req, res) {\n      res.writeHead(200, {'Content-Type': 'text/html'});\n      res.end('<html><body>' +\n        '<embed type=\"application/x-vlc-plugin\" target=\"' + stream.uri + '\"></embed>' +\n        '</body></html>');\n    }).listen(3030);\n  });\n});\n```\n\n## Other examples\n* example2.js takes an IP address range, scans the range for ONVIF devices (brute force scan) and dsplays information about each device found including make and model.\nFor Profile S Cameras and Encoders it displays the default RTSP address\nFor Profile G Recorders it displays the RTSP address of the first recording  \n\n\n* example3.js reads the command line cursor keys and sends PTZ commands to the Camera\n\n\n## Troubleshooting\nDifferent cameras have different ONVIF implementation. I've tested this module only with a couple of devices. So if you got different problems with this library, please let me know via e-mail. Else please just send the model of your\ncamera to me.\n\n# API\n\nThis page and API class documentation you can found here: [http://agsh.github.io/onvif/](http://agsh.github.io/onvif/)\n\nShort description of library possibilities is below.\n\n## Discovery\nSince 0.2.7 version library supports WS-Discovery of NVT devices. Currently it uses only `Probe` SOAP method that just works well.\nYou can find devices in your subnetwork using `probe` method of the Discovery singleton.\nDiscovery is an EventEmitter inheritor, so you can wait until discovery timeout, or subscribe on `device` event.\nHere some examples:\n\n```js\nvar onvif = require('onvif');\nonvif.Discovery.on('device', function(cam){\n// function will be called as soon as NVT responses\n\tcam.username = <USERNAME>;\n\tcam.password = <PASSWORD>;\n\tcam.connect(console.log);\n})\nonvif.Discovery.probe();\n```\n\n```js\nvar onvif = require('onvif');\nonvif.Discovery.probe(function(err, cams) {\n// function will be called only after timeout (5 sec by default)\n\tif (err) { throw err; }\n\tcams.forEach(function(cam) {\n\t\tcam.username = <USERNAME>;\n\t\tcam.password = <PASSWORD>;\n\t\tcam.connect(console.log);\n\t});\n});\n```\n\nIn all of that cases you've got disconnected cameras because to manage them you need tuple `username:password`.\nSo, as shown in the examples, you can assign these properties and call `connect` method to get full functionality.\n\n### Discovery.probe(options, callback)\nOptions\n\n- `timeout`, number. Time the probe method will wait NVT responses in ms\n- `resolve`, boolean. If this argument is false, all discovered NVTs would be presented as data object instead of Cam instance\n\n### Discovery events\n- `device(cam, remoteInfo, responseXML)` fires on device discover. `cam` is a Cam instance, remoteInfo is an object with network information\n and responseXML is a body of SOAP response\n- `error(error)` fires on some UDP error or on bad SOAP response from NVT\n\n## Cam class\n\n```javascript\nvar Cam = require('onvif').Cam;\n```\n\n## new Cam(options, callback)\n\nOptions are:\n- hostname\n- username, password (optional, to deal with majority of functions)\n- port (optional)\n\nIf the username and password are present, camera tries to connect automatically. Otherwise use `connect` method.\nOnce again, without credentials you can execute only `getSystemDateAndTime` method.\n\nCallback (optional) executes when the cam is initialised. Single argument for this function is possible error.\n\n#### Technical description\n\nWhen the cam object is created it automatically sends a `getCapabilities` command to the ONVIF device. If the device is a camera or encoder (NVT) it sends two commands to the ONVIF device:\n`getVideoSources` and `getProfiles`. It fills corresponding properties of an object:\n\n+ capabilities\n  - device\n  - events\n  - imaging\n  - media\n  - PTZ\n  - extension\n+ uri (this is a links to different NVT services)\n+ videoSources\n  - $.token\n  - framerate\n  - resolution\n+ profiles, array of profile object\n  - name\n  - videoSourceConfiguration\n  - videoEncoderConfiguration\n  - PTZConfiguration\n  \nAfter that it runs `getActiveSources` method. It iterates over all video sources and tries to find out proper configuration\nfor profile and videosource. First matching profile becomes a member of defaultProfiles array and video source configuration\nwith ptz configuration becomes a member of activeSources array.\n \nConfiguration for the first or the only one video source becomes defaultProfile and activeSource properties. All methods\nwithout passing options object use it. You can change it manually at any time.\n  \n+ defaultProfile (link to the first profile in profiles)\n+ activeSource (based on the default profile)\n  - sourceToken\n  - profileToken\n  - encoding\n  - width\n  - height\n  - fps\n  - bitrate\n  - ptz\n\n### connect(callback)\nConnect to the camera and fill device information properties with `getCapabilities`, `getVideoSources`, `getProfiles` methods\n\nSee more detailed information at http://www.onvif.org/ver10/media/wsdl/media.wsdl\nAfter cam initialisation we can run several ONVIF commands.\nThere are several common methods that work without credentials. Here are they: `getSystemDateAndTime`.\n\n### getSystemDateAndTime(callback)\nReturns a Date object with current camera datetime in the callback.\nWorks without credentials (passed `username` and `password` arguments).\n\n### getDeviceInformation(callback)\n*Device.* Returns a device information, such as manufacturer, model and firmware version in the callback\nWorks without credentials (passed `username` and `password` arguments).\n\n### getServices(callback)\n*Device.* Returns in callback and assigns to `#services` property an array consists of objects with properties: `namespace`, `XAddr`, `version`\n\n### getServiceCapabilities(callback)\n*Device.* Returns in callback and assigns to `#serviceCapabilities` property the capabilities of the device service (not media):\nnetwork, security and system. If your device supports some auxiliary capabilities they will be there too.\n\n### getStreamUri(options, callback)\n*Media.* Returns a URI that can be used to initiate a live media stream using RTSP as the control protocol\nThe options are:\n\n- `stream` (optional) - defines if a multicast or unicast stream is requested. Possible values are: 'RTP-Unicast' (default), 'RTP-Multicast'\n- `protocol` (optional) - defines the network protocol for streaming. Possible values are: 'UDP', 'TCP', 'RTSP' (default), 'HTTP'\n- `profileToken` (optional) - defines media profile to use and will define the configuration of the content of the stream. Default is `#activeSource.profileToken`\n\n### getSnapshotUri(options, callback)\n*Media.* Obtain a JPEG snapshot URI from the device.\n\n### getPresets(options, callback)\nReturns the saved presets as an a key-value object where the key is the name of a preset and a value is a preset token.\nThis method also stores the presets information in a `#presets` property of an object.\n\nThe options are:\n\n* `profileToken` (optional) - defines media profile to use and will define the configuration of the content of the stream. Default is `#activeSource.profileToken`\n\n### gotoPreset(options, callback)\nOperation to go to a saved preset position for the PTZ node in the selected profile.\n\nThe options are:\n\n* `profileToken` (optional) - defines media profile to use and will define the configuration of the content of the stream. Default is `#activeSource.profileToken`\n* `preset` - the name of preset. List of presets you can get by `#getPresets` method or in `#presets` property.\n\n### getNodes(callback)\n*PTZ.* Returns the properties of the current PTZ node, if it exists.\nUse this function to get maximum number of presets, ranges of admitted values for x, y, zoom, iris, focus.\nSets all information into `#nodes` property.\n\n### relativeMove(options, callback)\n*PTZ.* This is a relative pan-tilt-zoom method. Options for this method is a delta between desired and current position of the camera.\n\nThe options are:\n\n- `x` Pan, number or a string within -1 to 1, optional\n- `y` Tilt, number or a string within -1 to 1, optional\n- `zoom` Zoom, number or a string within -1 to 1, optional\n- `speed` An object with properties\n  * `x` Pan speed\n  * `y` Tilt speed\n  * `zoom` Zoom speed\n\n  If the speed option is omitted, the default speed set by the PTZConfiguration will be used.\n\nCallback is optional and means essentially nothing\n\n### absoluteMove(options, callback)\n*PTZ.* This is an absolute pan-tilt-zoom method. Options for this method is an absolute position of the camera.\n\nThe options are:\n\n- `x` Pan, number or a string within -1 to 1, optional\n- `y` Tilt, number or a string within -1 to 1, optional\n- `zoom` Zoom, number or a string within -1 to 1, optional\n- `speed` An object with properties\n  * `x` Pan speed\n  * `y` Tilt speed\n  * `zoom` Zoom speed\n\n  If the speed option is omitted, the default speed set by the PTZConfiguration will be used.\n\nCallback is optional and means essentially nothing\n\n### continuousMove(options, callback)\nOperation for continuous Pan/Tilt and Zoom movements\n\nThe options are:\n\n- `x` Pan velocity, number or a string within -1 to 1, optional\n- `y` Tilt velocity, number or a string within -1 to 1, optional\n- `zoom` Zoom velocity, number or a string within -1 to 1, optional\n- `timeout` Timeout in milliseconds, number. If timeout is omitted, movement will continue until `stop` command\n\n### stop(options, callback)\n*PTZ.* Stop ongoing pan, tilt and zoom movements of absolute relative and continuous type\n\nOptions and callback are optional. The options properties are:\n\n- `profileToken` (optional) - defines media profile to use and will define the configuration of the content of the stream. Default is `#activeSource.profileToken`\n- `panTilt` (optional) - set true when we want to stop ongoing pan and tilt movements. If `panTilt` arguments are not present, this command stops these movements.\n- `zoom` (optional) - set true when we want to stop ongoing zoom movement. If `zoom` arguments are not present, this command stops ongoing zoom movement.\n\n### getStatus(options, callback)\n*PTZ.* Returns an object with the current PTZ values.\n```javascript\n{\n\tposition: {\n\t\tx: 'pan position'\n\t\t, y: 'tilt position'\n\t\t, zoom: 'zoom'\n\t}\n\t, moveStatus: {} // camera moving\n\t, utcTime: 'current camera datetime'\n}\n```\n\n### getConfigurations(callback)\n*PTZ.* Get all the existing PTZConfigurations from the device. Configurations saved into `#configurations` property\n\n### getConfigurationOptions(configurationToken, callback)\n*PTZ.* Get supported coordinate systems including their range limitations for selected configuration. Extends corresponding\nconfiguration object\n\n## Supported methods\n* GetSystemDateAndTime\n* GetCapabilities\n* GetVideoSources\n* GetProfiles\n* GetServices\n* GetDeviceInformation\n* GetStreamUri\n* GetSnapshotUri\n* GetPresets\n* GotoPreset\n* RelativeMove\n* AbsoluteMove\n* ContinuousMove\n* Stop\n* GetStatus\n* SystemReboot\n* GetImagingSettings\n* SetImagingSettings\n* GetHostname\n* GetScopes\n* SetScopes\n* GetRecordings\n* GetReplayUri\n\n## Changelog\n- 0.5.3 Some fixes. Tests\n- 0.5.2 `preserveAddress` property for NAT devices, discovery with multiple network interfaces (@Climax777)\n- 0.5.1 Critical bugfix in SOAP-auth for some cams\n- 0.5.0 Profile G support (@RogerHardiman), proper SOAP auth, nodejs support >= 0.12\n- 0.4.2 Bugfixes\n- 0.4.1 Improved discovery (@sousandrei, @RogerHardiman) \n- 0.4.0 Encoder support (@chriswiggins), Imaging service (@EastL)\n- 0.3.1 EventEmitter-based events\n- 0.3.0 Refactoring, documentation, event service basics\n- 0.2.7 WS-Discovery\n\n## Links\nWSDL schemes and docs:\n- [Operations index](http://www.onvif.org/onvif/ver20/util/operationIndex.html)\n- http://www.onvif.org/onvif/ver10/tc/onvif_core_ver10.pdf\n- http://www.onvif.org/ver10/device/wsdl/devicemgmt.wsdl\n- http://www.onvif.org/ver10/media/wsdl/media.wsdl\n- http://www.onvif.org/ver20/ptz/wsdl/ptz.wsdl\n- http://www.onvif.org/onvif/ver10/recording.wsdl\n- http://www.onvif.org/onvif/ver10/replay.wsdl\n- [ONVIF Application Programmer's Guide](http://www.onvif.org/Portals/0/documents/WhitePapers/ONVIF_WG-APG-Application_Programmer's_Guide.pdf)\n",
  "readmeFilename": "README.md",
  "bugs": {
    "url": "https://github.com/agsh/onvif/issues"
  },
  "_id": "onvif@0.5.3",
  "dist": {
    "shasum": "0b1c9263c9644002b7199ca864fff788d7b702b9"
  },
  "_from": "onvif@^0.5.3",
  "_resolved": "https://registry.npmjs.org/onvif/-/onvif-0.5.3.tgz"
}
